## :building_construction: é€‚é…å™¨

### æ§åˆ¶ç½‘ç»œ

æˆ‘ä»¬æä¾›äº† ControlNet çš„è®­ç»ƒè„šæœ¬ï¼Œè¯¦ç»†å†…å®¹è¯·æŸ¥çœ‹ [./controlnet](./controlnet/README.md)ã€‚

```
shellCopy code# è®­ç»ƒ canny ControlNetã€‚
PYTHONPATH=./ sh hydit/train_controlnet.sh
```

æˆ‘ä»¬æä¾›äº†ä¸‰ç§ç±»å‹çš„è®­ç»ƒå¥½çš„ ControlNet æƒé‡ï¼ŒåŒ…æ‹¬ `canny`ã€`depth` å’Œ `pose`ï¼Œè¯¦ç»†ä¿¡æ¯è¯·æŸ¥çœ‹ [é“¾æ¥](https://huggingface.co/Tencent-Hunyuan/HYDiT-ControlNet)ã€‚

```
shellCopy codecd HunyuanDiT
# ä½¿ç”¨ huggingface-cli å·¥å…·ä¸‹è½½æ¨¡å‹ã€‚
# æˆ‘ä»¬å»ºè®®ä½¿ç”¨ç²¾ç®€æƒé‡ä½œä¸º ControlNet æ¨ç†çš„åŸºç¡€æ¨¡å‹ï¼Œå› ä¸ºæˆ‘ä»¬æä¾›çš„é¢„è®­ç»ƒæƒé‡æ˜¯åœ¨è¿™äº›æ¨¡å‹ä¸Šè®­ç»ƒçš„ã€‚
huggingface-cli download Tencent-Hunyuan/HYDiT-ControlNet --local-dir ./ckpts/t2i/controlnet
huggingface-cli download Tencent-Hunyuan/Distillation-v1.1 ./pytorch_model_distill.pt --local-dir ./ckpts/t2i/model

# å¿«é€Ÿå¼€å§‹
python3 sample_controlnet.py  --no-enhance --load-key distill --infer-steps 50 --control-type canny --prompt "åœ¨å¤œæ™šçš„é…’åº—é—¨å‰ï¼Œä¸€åº§å¤è€çš„ä¸­å›½é£æ ¼çš„ç‹®å­é›•åƒçŸ—ç«‹ç€ï¼Œå®ƒçš„çœ¼ç›é—ªçƒç€å…‰èŠ’ï¼Œä»¿ä½›åœ¨å®ˆæŠ¤ç€è¿™åº§å»ºç­‘ã€‚èƒŒæ™¯æ˜¯å¤œæ™šçš„é…’åº—å‰ï¼Œæ„å›¾æ–¹å¼æ˜¯ç‰¹å†™ï¼Œå¹³è§†ï¼Œå±…ä¸­æ„å›¾ã€‚è¿™å¼ ç…§ç‰‡å‘ˆç°äº†çœŸå®æ‘„å½±é£æ ¼ï¼Œè•´å«äº†ä¸­å›½é›•å¡‘æ–‡åŒ–ï¼ŒåŒæ—¶å±•ç°äº†ç¥ç§˜æ°›å›´" --condition-image-path controlnet/asset/input/canny.jpg --control-weight 1.0
```

<table>   <tr>     <td colspan="3" align="center">æ¡ä»¶è¾“å…¥</td>   </tr>    <tr>     <td align="center">Canny ControlNet </td>     <td align="center">Depth ControlNet </td>     <td align="center">Pose ControlNet </td>   </tr>   <tr>     <td align="center">åœ¨å¤œæ™šçš„é…’åº—é—¨å‰ï¼Œä¸€åº§å¤è€çš„ä¸­å›½é£æ ¼çš„ç‹®å­é›•åƒçŸ—ç«‹ç€ï¼Œå®ƒçš„çœ¼ç›é—ªçƒç€å…‰èŠ’ï¼Œä»¿ä½›åœ¨å®ˆæŠ¤ç€è¿™åº§å»ºç­‘ã€‚èƒŒæ™¯æ˜¯å¤œæ™šçš„é…’åº—å‰ï¼Œæ„å›¾æ–¹å¼æ˜¯ç‰¹å†™ï¼Œå¹³è§†ï¼Œå±…ä¸­æ„å›¾ã€‚è¿™å¼ ç…§ç‰‡å‘ˆç°äº†çœŸå®æ‘„å½±é£æ ¼ï¼Œè•´å«äº†ä¸­å›½é›•å¡‘æ–‡åŒ–ï¼ŒåŒæ—¶å±•ç°äº†ç¥ç§˜æ°›å›´<br>ï¼ˆAt night, an ancient Chinese-style lion statue stands in front of the hotel, its eyes gleaming as if guarding the building. The background is the hotel entrance at night, with a close-up, eye-level, and centered composition. This photo presents a realistic photographic style, embodies Chinese sculpture culture, and reveals a mysterious atmosphere.ï¼‰ </td>     <td align="center">åœ¨èŒ‚å¯†çš„æ£®æ—ä¸­ï¼Œä¸€åªé»‘ç™½ç›¸é—´çš„ç†ŠçŒ«é™é™åœ°ååœ¨ç»¿æ ‘çº¢èŠ±ä¸­ï¼Œå‘¨å›´æ˜¯å±±å·å’Œæµ·æ´‹ã€‚èƒŒæ™¯æ˜¯ç™½å¤©çš„æ£®æ—ï¼Œå…‰çº¿å……è¶³<br>ï¼ˆIn the dense forest, a black and white panda sits quietly in green trees and red flowers, surrounded by mountains, rivers, and the ocean. The background is the forest in a bright environment.ï¼‰ </td>     <td align="center">ä¸€ä½äºšæ´²å¥³æ€§ï¼Œèº«ç©¿ç»¿è‰²ä¸Šè¡£ï¼Œæˆ´ç€ç´«è‰²å¤´å·¾å’Œç´«è‰²å›´å·¾ï¼Œç«™åœ¨é»‘æ¿å‰ã€‚èƒŒæ™¯æ˜¯é»‘æ¿ã€‚ç…§ç‰‡é‡‡ç”¨è¿‘æ™¯ã€å¹³è§†å’Œå±…ä¸­æ„å›¾çš„æ–¹å¼å‘ˆç°çœŸå®æ‘„å½±é£æ ¼<br>ï¼ˆAn Asian woman, dressed in a green top, wearing a purple headscarf and a purple scarf, stands in front of a blackboard. The background is the blackboard. The photo is presented in a close-up, eye-level, and centered composition, adopting a realistic photographic styleï¼‰ </td>   </tr>   <tr>     <td align="center"><img src="controlnet/asset/input/canny.jpg" alt="Image 0" width="200"/></td>     <td align="center"><img src="controlnet/asset/input/depth.jpg" alt="Image 1" width="200"/></td>     <td align="center"><img src="controlnet/asset/input/pose.jpg" alt="Image 2" width="200"/></td>   </tr>   <tr>     <td colspan="3" align="center">ControlNet è¾“å‡º</td>   </tr>   <tr>     <td align="center"><img src="controlnet/asset/output/canny.jpg" alt="Image 3" width="200"/></td>     <td align="center"><img src="controlnet/asset/output/depth.jpg" alt="Image 4" width="200"/></td>     <td align="center"><img src="controlnet/asset/output/pose.jpg" alt="Image 5" width="200"/></td>   </tr> </table>

## :art: Hunyuan-Captioner

Hunyuan-Captioner é€šè¿‡ä¿æŒé«˜åº¦çš„å›¾åƒæ–‡æœ¬ä¸€è‡´æ€§æ¥æ»¡è¶³æ–‡æœ¬åˆ°å›¾åƒæŠ€æœ¯çš„éœ€æ±‚ã€‚å®ƒå¯ä»¥ä»å¤šä¸ªè§’åº¦ç”Ÿæˆé«˜è´¨é‡çš„å›¾åƒæè¿°ï¼ŒåŒ…æ‹¬å¯¹è±¡æè¿°ã€å¯¹è±¡å…³ç³»ã€èƒŒæ™¯ä¿¡æ¯ã€å›¾åƒé£æ ¼ç­‰ã€‚æˆ‘ä»¬çš„ä»£ç åŸºäº [LLaVA](https://github.com/haotian-liu/LLaVA) å®ç°ã€‚

### ç¤ºä¾‹

<td align="center"><img src="./asset/caption_demo.jpg" alt="Image 3" width="1200"/></td>

### æŒ‡å¯¼è¯´æ˜

a. å®‰è£…ä¾èµ–é¡¹

ä¾èµ–é¡¹å’Œå®‰è£…åŸºæœ¬ä¸ [**åŸºç¡€æ¨¡å‹**](https://huggingface.co/Tencent-Hunyuan/HunyuanDiT-v1.1) ç›¸åŒã€‚

b. æ¨¡å‹ä¸‹è½½

```
shellCopy code# ä½¿ç”¨ huggingface-cli å·¥å…·ä¸‹è½½æ¨¡å‹ã€‚
huggingface-cli download Tencent-Hunyuan/HunyuanCaptioner --local-dir ./ckpts/captioner
```

### æ¨ç†

æˆ‘ä»¬çš„æ¨¡å‹æ”¯æŒä¸‰ç§ä¸åŒæ¨¡å¼ï¼ŒåŒ…æ‹¬ï¼š**ç›´æ¥ç”Ÿæˆä¸­æ–‡æè¿°**ï¼Œ**åŸºäºç‰¹å®šçŸ¥è¯†ç”Ÿæˆä¸­æ–‡æè¿°**ï¼Œä»¥åŠ**ç›´æ¥ç”Ÿæˆè‹±æ–‡æè¿°**ã€‚æ’å…¥çš„ä¿¡æ¯å¯ä»¥æ˜¯ç²¾ç¡®çš„çº¿ç´¢æˆ–å˜ˆæ‚çš„æ ‡ç­¾ï¼ˆä¾‹å¦‚ä»äº’è”ç½‘ä¸ŠæŠ“å–çš„åŸå§‹æè¿°ï¼‰ã€‚è¯¥æ¨¡å‹èƒ½å¤ŸåŸºäºæ’å…¥çš„ä¿¡æ¯å’Œå›¾åƒå†…å®¹ç”Ÿæˆå¯é ä¸”å‡†ç¡®çš„æè¿°ã€‚

| æ¨¡å¼           | æç¤ºæ¨¡æ¿                                  | æè¿°                 |
| -------------- | ----------------------------------------- | -------------------- |
| caption_zh     | æè¿°è¿™å¼ å›¾ç‰‡                              | ä¸­æ–‡æè¿°             |
| insert_content | æ ¹æ®æç¤ºè¯â€œ{}â€,æè¿°è¿™å¼ å›¾ç‰‡               | æ’å…¥çŸ¥è¯†åçš„ä¸­æ–‡æè¿° |
| caption_en     | Please describe the content of this image | è‹±æ–‡æè¿°             |

a. å•å¼ å›¾ç‰‡ä¸­æ–‡æ¨ç†

```
bash
Copy code
python mllm/caption_demo.py --mode "caption_zh" --image_file "mllm/images/demo1.png" --model_path "./ckpts/captioner"
```

b. æ’å…¥ç‰¹å®šçŸ¥è¯†è¿›è¡Œæè¿°

```
bash
Copy code
python mllm/caption_demo.py --mode "insert_content" --content "å®«ä¿é¸¡ä¸" --image_file "mllm/images/demo2.png" --model_path "./ckpts/captioner"
```

c. å•å¼ å›¾ç‰‡è‹±æ–‡æ¨ç†

```
bash
Copy code
python mllm/caption_demo.py --mode "caption_en" --image_file "mllm/images/demo3.png" --model_path "./ckpts/captioner"
```

d. å¤šå¼ å›¾ç‰‡ä¸­æ–‡æ¨ç†

```
bashCopy code### å°†å¤šå¼ å›¾ç‰‡è½¬æ¢ä¸º csv æ–‡ä»¶ã€‚ 
python mllm/make_csv.py --img_dir "mllm/images" --input_file "mllm/images/demo.csv"

### å¤šå¼ å›¾ç‰‡æ¨ç†
python mllm/caption_demo.py --mode "caption_zh" --input_file
```

## åŠ é€Ÿï¼ˆé€‚ç”¨äºLinuxï¼‰

- æˆ‘ä»¬æä¾›äº†ç”¨äºæ¨ç†åŠ é€Ÿçš„HunyuanDiTçš„TensorRTç‰ˆæœ¬ï¼ˆæ¯”é—ªç”µæ³¨æ„åŠ›æ›´å¿«ï¼‰ã€‚è¯¦ç»†ä¿¡æ¯è¯·å‚è§[Tencent-Hunyuan/TensorRT-libs](https://huggingface.co/Tencent-Hunyuan/TensorRT-libs)ã€‚
- æˆ‘ä»¬æä¾›äº†ç”¨äºæ¨ç†åŠ é€Ÿçš„HunyuanDiTçš„è’¸é¦ç‰ˆæœ¬ã€‚è¯¦ç»†ä¿¡æ¯è¯·å‚è§[Tencent-Hunyuan/Distillation](https://huggingface.co/Tencent-Hunyuan/Distillation)ã€‚

## ğŸ”— BibTeX

å¦‚æœæ‚¨è®¤ä¸º[Hunyuan-DiT](https://arxiv.org/abs/2405.08748)æˆ–[DialogGen](https://arxiv.org/abs/2403.08857)å¯¹æ‚¨çš„ç ”ç©¶å’Œåº”ç”¨æœ‰å¸®åŠ©ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹BibTeXå¼•ç”¨ï¼š

```
@misc{li2024hunyuandit,
      title={Hunyuan-DiT: A Powerful Multi-Resolution Diffusion Transformer with Fine-Grained Chinese Understanding}, 
      author={Zhimin Li and Jianwei Zhang and Qin Lin and Jiangfeng Xiong and Yanxin Long and Xinchi Deng and Yingfang Zhang and Xingchao Liu and Minbin Huang and Zedong Xiao and Dayou Chen and Jiajun He and Jiahao Li and Wenyue Li and Chen Zhang and Rongwei Quan and Jianxiang Lu and Jiabin Huang and Xiaoyan Yuan and Xiaoxiao Zheng and Yixuan Li and Jihong Zhang and Chao Zhang and Meng Chen and Jie Liu and Zheng Fang and Weiyan Wang and Jinbao Xue and Yangyu Tao and Jianchen Zhu and Kai Liu and Sihuan Lin and Yifu Sun and Yun Li and Dongdong Wang and Mingtao Chen and Zhichao Hu and Xiao Xiao and Yan Chen and Yuhong Liu and Wei Liu and Di Wang and Yong Yang and Jie Jiang and Qinglin Lu},
      year={2024},
      eprint={2405.08748},
      archivePrefix={arXiv},
      primaryClass={cs.CV}
}

@article{huang2024dialoggen,
  title={DialogGen: Multi-modal Interactive Dialogue System for Multi-turn Text-to-Image Generation},
  author={Huang, Minbin and Long, Yanxin and Deng, Xinchi and Chu, Ruihang and Xiong, Jiangfeng and Liang, Xiaodan and Cheng, Hong and Lu, Qinglin and Liu, Wei},
  journal={arXiv preprint arXiv:2403.08857},
  year={2024}
}
```

## Start History

<a href="https://star-history.com/#Tencent/HunyuanDiT&Date">

 <picture>
   <source media="(prefers-color-scheme: dark)" srcset="https://api.star-history.com/svg?repos=Tencent/HunyuanDiT&type=Date&theme=dark" />
   <source media="(prefers-color-scheme: light)" srcset="https://api.star-history.com/svg?repos=Tencent/HunyuanDiT&type=Date" />
   <img alt="Star History Chart" src="https://api.star-history.com/svg?repos=Tencent/HunyuanDiT&type=Date" />
 </picture>

</a>
